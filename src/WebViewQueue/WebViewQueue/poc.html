<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <p>Test</p>
        <script>
            function someLongRunningProcess(length, pid) {

                // approach 1: direct call back to native
                /*window.webkit.messageHandlers.continueHandler.postMessage({"pid":pid})*/
                
                // approach 2: setTimeout, then call back to native after random duration within 4000ms
                /*setTimeout(function() {
                    window.webkit.messageHandlers.continueHandler.postMessage({"pid":pid})
                }, getRandomInt(1000,4000));*/

                // approach 3: setTimeout nested twice. Simulates queueing up an operation that takes around half a second and later queueing up a response callback
                setTimeout(function() {
                    delay(500)
                    setTimeout(function() {
                        window.webkit.messageHandlers.continueHandler.postMessage({"pid":pid})
                    }, 0);
                }, 0);
            }
        
            function getRandomInt(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
        
            function delay(ms) {
                var cur_d = new Date();
                var cur_ticks = cur_d.getTime();
                var ms_passed = 0;
                while(ms_passed < ms) {
                    var d = new Date();
                    var ticks = d.getTime();
                    ms_passed = ticks - cur_ticks;
                }
            }
        </script>
    </body>
</html>